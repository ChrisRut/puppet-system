<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Puppet-system : Manage Linux system resources and services from hiera configuration" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Puppet-system</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/erwbgy/puppet-system">View on GitHub</a>

          <h1 id="project_title">Puppet-system</h1>
          <h2 id="project_tagline">Manage Linux system resources and services from hiera configuration</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/erwbgy/puppet-system/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/erwbgy/puppet-system/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>puppet-system</h1>

<p>Manage Linux system resources and services from hiera configuration.</p>

<ul>
<li>
<em>augeas</em>: apply file changes using the augeas tool</li>
<li>
<em>crontabs</em>: set user crontab entries</li>
<li>
<em>execs</em>:  run idempotent external commands</li>
<li>
<em>facts</em>: set custom facts</li>
<li>
<em>files</em>: create/update files or directories</li>
<li>
<em>groups</em>: manage entries in /etc/group</li>
<li>
<em>hosts</em>: manage entries in /etc/hosts</li>
<li>
<em>limits</em>: manage entries in /etc/security/limits.conf</li>
<li>
<em>mailaliases</em> manage entries in /etc/aliases</li>
<li>
<em>mounts</em>: manage entries in /etc/fstab</li>
<li>
<em>packages</em>: manage system packages</li>
<li>
<em>schedules</em>: determine when resource config should not be applied and how often</li>
<li>
<em>services</em>: manage system services</li>
<li>
<em>sshd</em>: manage configuration in /etc/ssh/sshd_config including subsystems like sftp</li>
<li>
<em>sysconfig</em>: manage files under /etc/sysconfig: clock, i18n, keyboard, puppet-dashboard, puppet, puppetmaster, selinux</li>
<li>
<em>sysctl</em>: manage entries in /etc/sysctl.conf</li>
<li>
<em>users</em>: manage users in /etc/passwd and /etc/shadow</li>
<li>
<em>yumgroups</em>: manage system package groups</li>
<li>
<em>yumrepos</em>: manage yum repository files under /etc/yum.repos.d</li>
</ul><h2>Documentation</h2>

<p>For default types (users, groups, mounts, yumrepos, packages, cron, exec) see
the documentation at <a href="http://docs.puppetlabs.com/references/latest/type.html">http://docs.puppetlabs.com/references/latest/type.html</a> for
the parameters that can be passed to each of the resources.</p>

<p>For augeasproviders types (sysctl, sshd) see
<a href="http://forge.puppetlabs.com/domcleal/augeasproviders">http://forge.puppetlabs.com/domcleal/augeasproviders</a>.</p>

<p>For limits see <a href="http://forge.puppetlabs.com/erwbgy/limits">http://forge.puppetlabs.com/erwbgy/limits</a>.</p>

<h2>Usage</h2>

<p>Include the system module in your puppet configuration:</p>

<pre><code>include system
</code></pre>

<p>and add required hiera configuration.</p>

<p>Note: To exclude certain system classes when doing 'include system' you can set
their schedule parameter to 'never'.  This may be useful when testing or
debugging issues or just to prevent config lower in the hierarchy being
applied.</p>

<p>For example:</p>

<pre><code>system::packages::schedule:  'never'
system::yumgroups::schedule: 'never'
</code></pre>

<p>will ignore any configuration for system::packages and system::yumgroups.</p>

<h2>augeas</h2>

<p>Apply changes to files using the augeas tool.  This enables configuration file
changes to be made without writing new classes.</p>

<p>Example 1:</p>

<pre><code>system::augeas:
  'test1':
    context: '/files/etc/sysconfig/firstboot'
    changes:
      - 'set RUN_FIRSTBOOT YES'
    onlyif:  'match other_value size &gt; 0'
</code></pre>

<p>Example 2:</p>

<pre><code>system::augeas:
  'jboss_conf':
    content: '/files'
    changes:
      - 'set etc/jbossas/jbossas.conf/JBOSS_IP $ipaddress'
      - 'set etc/jbossas/jbossas.conf/JAVA_HOME /usr'
    load_path: '/usr/share/jbossas/lenses'
</code></pre>

<p>Defaults:</p>

<ul>
<li>ensure: present</li>
<li>user: root</li>
</ul><h2>crontabs</h2>

<p>Set user crontab entries</p>

<p>Example configuration:</p>

<pre><code>system::crontabs:
  'root-logrotate':
    command: '/usr/sbin/logrotate'
    user:    'root'
    hour:    '2'
    minute:  '0'
</code></pre>

<p>Defaults:</p>

<ul>
<li>ensure: present</li>
<li>user: root</li>
</ul><h2>execs</h2>

<p>Run idempotent external commands</p>

<p>Example configuration:</p>

<pre><code>system::execs:
  'update-tomcat-deploy':
    command: '/usr/bin/svn up'
    cwd:     '/apps/tomcat1/deploy'
    user:    'tomcat1'
  'create-deploy-dir':
    command: '/bin/mkdir -p /apps/tomcat1/deploy'
    unless:  '/usr/bin/test -d /apps/tomcat1/deploy'
</code></pre>

<p>Note: The commands will be run on every Puppet run unless you specify 'onlyif',
'unless' or 'refreshonly' parameters.</p>

<h2>facts</h2>

<p>Set custom facts</p>

<p>Example configuration:</p>

<pre><code>system::facts:
  location:
    value: 'London'
</code></pre>

<h2>files</h2>

<p>Create or update files or directories</p>

<p>Example 1 - create a mount point for an NFS mounted directory:</p>

<pre><code>system::files:
  /apps:
    ensure:  'directory'
    owner:   'root'
    group:   'root'
    mode:    '0755'
</code></pre>

<p>Example 2 - create a file with the given content:</p>

<pre><code>system::files:
  /etc/motd:
    ensure:  'present'
    owner:   'root'
    group:   'root'
    mode:    '0644'
    content: "Authorised access only\nIf unauthorised log off now or face prosecution\n"
</code></pre>

<p>Note: Use double-quotes with content if it contains embedded newlines (\n) or
tabs (\t).  Normaly you will also want a terminating newline.</p>

<h2>groups</h2>

<p>Manage entries in /etc/group</p>

<p>Example configuration:</p>

<pre><code>system::groups:
  'keith':
    ensure: 'present'
    gid:    '500'
  'fred':
    gid:    '503'
</code></pre>

<p>Defaults:</p>

<ul>
<li>ensure: present</li>
</ul><h2>hosts</h2>

<p>Manage entries in /etc/hosts</p>

<p>Example configuration:</p>

<pre><code>system::hosts:
  puppet:
    ensure:       'present'
    ip:           '10.5.11.19'
    host_aliases: [ 'puppet.local' ]
</code></pre>

<p>Defaults:</p>

<ul>
<li>ensure: present</li>
</ul><p>See: <a href="http://docs.puppetlabs.com/references/latest/type.html#host">http://docs.puppetlabs.com/references/latest/type.html#host</a></p>

<h2>limits</h2>

<p>Manage entries in /etc/security/limits.conf</p>

<p>Example configuration:</p>

<pre><code>system::limits:
  '*':
    nofile:
      soft: 1024
      hard: 2048
  '@weblogic':
    nofile:
      soft: 16384
      hard: 16384
    nproc:
      soft: 2048
      hard: 2048
</code></pre>

<p>No defaults.</p>

<h2>mailaliases</h2>

<p>Manage entries in /etc/aliases</p>

<p>Example configuration:</p>

<pre><code>system::mailaliases:
  postmaster:
    recipient: 'root'
  webmaster:
    recipient: 'fred@domain.com'
</code></pre>

<p>No defaults.</p>

<p>See: <a href="http://docs.puppetlabs.com/references/latest/type.html#mailalias">http://docs.puppetlabs.com/references/latest/type.html#mailalias</a></p>

<h2>mounts</h2>

<p>Manage entries in /etc/fstab</p>

<p>Example configuration:</p>

<pre><code>system::mounts:
  '/home':
    ensure:  'mounted'
    device:  '/dev/mapper/vg_x120-lv_home'
    atboot:  'true'
    fstype:  'ext4'
    options: 'defaults'
</code></pre>

<p>Defaults:</p>

<ul>
<li>atboot: true</li>
<li>ensure: mounted</li>
</ul><p>Note: These resources are created last so any required users, groups or mount
point directories have a chance to be created first.</p>

<h2>packages</h2>

<p>Manage system packages</p>

<p>Example configuration:</p>

<pre><code>system::packages:
  AdobeReader_enu:
    ensure: '9.5.1-1'
  ConsoleKit:
    ensure: '0.4.5-2.fc17'
</code></pre>

<p>Defaults:</p>

<ul>
<li>ensure: installed</li>
</ul><h2>schedules</h2>

<p>Create schedules that determine when a resource should not be applied and the
number times it should be applied within a specified time period.</p>

<p>Example configuration:</p>

<pre><code>system::schedules:
  'maintenance':
    range:  '2 - 4'
    period: 'daily'
    repeat: 1
  'half-hourly':
    period: 'hourly'
    repeat: 2
</code></pre>

<p>The defined schedules can then be passed using the 'schedule' parameter to
other types.</p>

<p>Example 1:</p>

<pre><code>system::schedule: 'maintenance'
</code></pre>

<p>sets the default schedule for all system resources so that they are only
run during the maintenance window of 2:00 to 04:59.</p>

<p>Example 2:</p>

<pre><code>system::services::schedule: 'daily'
</code></pre>

<p>sets the default schedule for all system::services resources to be once a day.</p>

<p>Example 3:</p>

<pre><code>system::services:
  httpd:
    ensure: 'running'
    enable: 'true'
    schedule: 'half-hourly'
</code></pre>

<p>overrides the services schedule for the httpd resource using a custom schedule
we defined above.</p>

<p>The default Puppet schedules are:</p>

<ul>
<li>daily</li>
<li>hourly</li>
<li>monthly</li>
<li>never</li>
<li>weekly</li>
</ul><p>and the system::schedule class defines another called <em>always</em> that schedules
the resource on every Puppet run.</p>

<h2>services</h2>

<p>Manage system services</p>

<p>Example configuration:</p>

<pre><code>system::services:
  cups:
    ensure: 'stopped'
    enable: 'false'
  sshd:
    ensure: 'running'
    enable: 'true'
  ntpd:
    ensure: 'running'
    enable: 'true'
</code></pre>

<p>Defaults:</p>

<ul>
<li>ensure: running</li>
</ul><p>Note:</p>

<ul>
<li>Do not specify any services that are managed by other Puppet modules (eg.
ntpd or network) otherwise you may get conflicts</li>
</ul><h2>sshd</h2>

<p>Manage settings in /etc/ssh/sshd.conf</p>

<p>Synchronize host keys file entries across all puppet-managed hosts.</p>

<p>Example configuration:</p>

<pre><code>system::sshd:
  AllowGroups:
    value:     [ 'sshusers', 'admin' ]
  PermitRootLogin:
    value:     'without-password'
    condition: 'Host example.net'

system::sshd::subsystem:
  sftp:
    command: '/usr/libexec/openssh/sftp-server -u 0002'

system::sshd::sync_host_keys: 'true'
</code></pre>

<p>No defaults.</p>

<p>See:</p>

<ul>
<li><a href="https://github.com/domcleal/augeasproviders/blob/master/lib/puppet/type/sshd_config.rb">https://github.com/domcleal/augeasproviders/blob/master/lib/puppet/type/sshd_config.rb</a></li>
<li><a href="https://github.com/domcleal/augeasproviders/blob/master/lib/puppet/type/sshd_config_subsystem.rb">https://github.com/domcleal/augeasproviders/blob/master/lib/puppet/type/sshd_config_subsystem.rb</a></li>
</ul><h2>sysconfig</h2>

<p>Manage settings in files under /etc/sysconfig</p>

<p>Example configuration:</p>

<pre><code>system::sysconfig::clock:
  timezone: 'Europe/London'

system::sysconfig::i18n:
  # Run 'locale -a' to see possible lang values
  lang: 'en_GB.utf8'

system::sysconfig::keyboard:
  keytable:     'uk'
  model:        'pc105'
  layout:       'gb'
  keyboardtype: 'pc'

system::sysconfig::puppet:
  server: 'puppet.sbet'

system::sysconfig::selinux:
  state: 'enforcing'
</code></pre>

<p>No defaults.</p>

<p>Note: Values must not contain whitespace</p>

<h2>sysctl</h2>

<p>Manage settings in /etc/sysctl.conf</p>

<p>Example configuration:</p>

<pre><code>system::sysctl:
  kernel.msgmnb:
    value: '131072'
    comment: 'Controls the default maximum size of a message queue'
  kernel.msgmax:
    value: '131072'
    comment: ' Controls the maximum size of a message, in bytes'
</code></pre>

<p>No defaults.</p>

<p>See:</p>

<ul>
<li><a href="https://github.com/domcleal/augeasproviders/blob/master/lib/puppet/type/sysctl.rb">https://github.com/domcleal/augeasproviders/blob/master/lib/puppet/type/sysctl.rb</a></li>
</ul><p>Note: Quote numeric values to avoid "can't convert Fixnum into String" errors</p>

<h2>users</h2>

<p>Manage users entries in /etc/passwd and /etc/shadow</p>

<p>Example configuration:</p>

<pre><code>system::users:
  'keith':
    ensure:    'present'
    comment:   'Keith Burdis'
    gid:       '500'
    groups:    ['wheel']
    home:      '/home/keith'
    shell:     '/bin/bash'
    uid:       '500'
  'fred':
    comment:   'Fred Bloggs'
    uid:       '503'
    gid:       '503'
    home:      '/home/fred'
    managehome: true
</code></pre>

<p>Defaults:</p>

<ul>
<li>ensure: present</li>
<li>shell:  /bin/bash</li>
</ul><h2>yumgroups</h2>

<p>Manage system package groups</p>

<p>Example configuration:</p>

<pre><code>system::yumgroups:
  'Base':
    ensure: 'present'
  'Console internet tools':
    ensure: 'present'
  'Perl Support':
    ensure: 'present'
    usecache: false
  'Ruby Support':
    ensure: 'present'
    optional: true
    usecache: false
</code></pre>

<p>Defaults:</p>

<ul>
<li>optional: false</li>
<li>usecache: true</li>
<li>schedule: daily</li>
</ul><p>Note: Set 'usecache: false' if 'yum -C grouplist' does not work on your system
and you are getting System::Yumgroup resources created on every Puppet run</p>

<p>Note: By default the yumgroup type has a 'daily' schedule to reduce the time
Puppet runs take - package group changes are usually rare after the host is
first set up. This means that it will run once every 24 hours. You override
this by supplying your own schedule parameter - see system::schedules to create
your own custom schedules.</p>

<h2>yumrepos</h2>

<p>Manage yum repository files under /etc/yum.repos.d</p>

<p>Example configuration:</p>

<pre><code>system::yumrepos:
  'puppetlabs-deps':
    baseurl:  'http://yum.puppetlabs.com/fedora/f17/dependencies/$basearch'
    descr:    'Puppet Labs Dependencies Fedora 17 - $basearch'
    enabled:  '1'
    gpgcheck: '1'
    gpgkey:   'file:///etc/pki/rpm-gpg/RPM-GPG-KEY-puppetlabs'
  'puppetlabs-products':
    baseurl:  'http://yum.puppetlabs.com/fedora/f17/products/$basearch'
    descr:    'Puppet Labs Products Fedora 17 - $basearch'
    enabled:  '1'
    gpgcheck: '1'
    gpgkey:   'file:///etc/pki/rpm-gpg/RPM-GPG-KEY-puppetlabs'
</code></pre>

<p>Defaults:</p>

<ul>
<li>enabled: 1</li>
<li>gpgcheck: 1</li>
</ul><h2>providers</h2>

<p>The augeasproviders module can be an alternate provider for the host, mailalias
and mounttab types.</p>

<p>Example configuration:</p>

<pre><code>system::providers:
  host: 'augeas'
  mailalias: 'augeas'
  mounttab: 'augeas'
</code></pre>

<h2>Notes</h2>

<ul>
<li>
<p>When requiring packages in other modules wrap them in an "if !defined" check
to avoid conflicts with system::packages - for example:</p>

<p>if ! defined(Package['bash']) { package { 'bash': ensure =&gt; installed } }</p>
</li>
<li><p>Put the system class <em>first</em> in the list of classes to include when using
hiera_include. This avoids problems with conflicting package declarations -
which shouldn't be a problem because system::packages is run in an earlier 
run stage but is.</p></li>
<li><p>As with many default types you can often specify a 'target' parameter to
specify a different configuration filename to change.</p></li>
</ul><h2>Support</h2>

<p>License: Apache License, Version 2.0</p>

<p>GitHub URL: <a href="https://github.com/erwbgy/puppet-system">https://github.com/erwbgy/puppet-system</a></p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Puppet-system maintained by <a href="https://github.com/erwbgy">erwbgy</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-37513727-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
